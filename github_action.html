<!DOCTYPE html>
<!-- Chosen Palette: Cool Neutrals & Sky Blue -->
<!-- Application Structure Plan: The SPA is structured as an interactive assistant. It features a two-column layout. The left column contains configuration options (like branch name) and a visual flowchart of the process, allowing users to understand the automation at a glance. The right column presents a clear, step-by-step guide. The core interaction is the dynamic generation of the necessary YAML code based on user input, which replaces the static code block from the report. This task-oriented design is more user-friendly and less error-prone than a simple tutorial, guiding the user directly from configuration to deployment. -->
<!-- Visualization & Content Choices: 
- Report Info: The entire process of using GitHub Actions. -> Goal: Organize & Explain. -> Viz/Presentation: A vertical flowchart built with simple HTML and Tailwind CSS, using numbered circles and arrows to visualize the sequence. Interaction: Static visual aid. Justification: A visual flowchart is much easier to digest than a paragraph of text explaining the process flow.
- Report Info: The YAML configuration file. -> Goal: Interact & Generate. -> Viz/Presentation: A syntax-highlighted code block within the guide. Interaction: The content of this block is dynamically generated based on user input from the configuration panel. A 'Copy' button is provided for convenience. Justification: This transforms a passive copying task into an active configuration step, reducing errors and making the user feel in control.
- Report Info: Step-by-step instructions. -> Goal: Guide. -> Viz/Presentation: The steps are presented in a clean, linear fashion inside a main content card. Justification: A simple, numbered guide is the clearest way to present procedural instructions.
-->
<!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>交互式 GitHub Actions 索引页生成器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans SC', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        .code-highlight {
            background-color: #f8f8f8;
            color: #333;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;
        }
    </style>
</head>
<body class="bg-slate-50">
    <div class="container mx-auto max-w-5xl p-4 sm:p-6 md:p-8">
        <header class="text-center my-8 md:my-12">
            <h1 class="text-4xl md:text-5xl font-bold text-slate-800">GitHub Actions 索引页生成器</h1>
            <p class="mt-4 text-lg text-slate-600 max-w-3xl mx-auto">一个将静态教程转化为动态助手的交互式工具，帮您自动创建、更新并美化您网站的索引目录。</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <aside class="lg:col-span-1 space-y-6">
                <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                    <h2 class="text-2xl font-bold text-slate-800 mb-4">⚙️ 配置选项</h2>
                    <div>
                        <label for="branchName" class="block text-sm font-medium text-slate-700">您的主分支名称</label>
                        <input type="text" id="branchName" value="main" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-sky-500 focus:ring-2 focus:ring-sky-200 transition sm:text-sm">
                        <p class="mt-2 text-xs text-slate-500">通常是 'main' 或 'master'。</p>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                    <h3 class="text-xl font-bold text-slate-800 mb-4">工作原理</h3>
                    <div class="space-y-3 text-sm">
                        <div class="flex items-center"><div class="bg-sky-500 text-white rounded-full w-6 h-6 flex items-center justify-center font-bold mr-3 shrink-0">1</div><span class="text-slate-700">您提交代码到 GitHub</span></div>
                        <div class="pl-3"><div class="h-4 w-px bg-slate-300 ml-px"></div></div>
                        <div class="flex items-center"><div class="bg-sky-500 text-white rounded-full w-6 h-6 flex items-center justify-center font-bold mr-3 shrink-0">2</div><span class="text-slate-700">GitHub Actions 自动运行</span></div>
                        <div class="pl-3"><div class="h-4 w-px bg-slate-300 ml-px"></div></div>
                        <div class="flex items-center"><div class="bg-sky-500 text-white rounded-full w-6 h-6 flex items-center justify-center font-bold mr-3 shrink-0">3</div><span class="text-slate-700">生成最新的 `index.html`</span></div>
                        <div class="pl-3"><div class="h-4 w-px bg-slate-300 ml-px"></div></div>
                        <div class="flex items-center"><div class="bg-sky-500 text-white rounded-full w-6 h-6 flex items-center justify-center font-bold mr-3 shrink-0">4</div><span class="text-slate-700">自动提交新索引文件</span></div>
                        <div class="pl-3"><div class="h-4 w-px bg-slate-300 ml-px"></div></div>
                        <div class="flex items-center"><div class="bg-sky-500 text-white rounded-full w-6 h-6 flex items-center justify-center font-bold mr-3 shrink-0">5</div><span class="text-slate-700">Cloudflare Pages 自动部署</span></div>
                    </div>
                </div>
            </aside>

            <main class="lg:col-span-2">
                 <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                    <h2 class="text-2xl font-bold text-slate-800 mb-2">🚀 操作指南</h2>
                    <p class="text-slate-600 mb-6">请跟随以下步骤，将自动化魔法添加到您的项目中。</p>

                    <div id="step-1">
                        <h3 class="text-lg font-semibold text-slate-800 mb-2 flex items-center"><span class="bg-slate-800 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center mr-2">1</span>创建工作流文件</h3>
                        <p class="text-sm text-slate-600 mb-4 pl-7">在您的 GitHub 仓库中，创建一个新文件，路径为 <code class="bg-slate-200 text-slate-800 px-1 py-0.5 rounded text-xs font-mono">.github/workflows/generate-index.yml</code>，然后将下方为您动态生成的代码粘贴进去。</p>
                        <div class="bg-slate-900 rounded-lg overflow-hidden relative group">
                             <pre class="p-4 text-sm text-white overflow-x-auto"><code id="code-block" class="language-yaml"></code></pre>
                             <button id="copy-button" class="absolute top-3 right-3 bg-slate-600 text-white text-xs px-3 py-1.5 rounded-md hover:bg-sky-500 transition-all opacity-0 group-hover:opacity-100">复制</button>
                        </div>
                    </div>

                    <div id="step-2" class="mt-8">
                         <h3 class="text-lg font-semibold text-slate-800 mb-2 flex items-center"><span class="bg-slate-800 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center mr-2">2</span>提交并验证</h3>
                         <p class="text-sm text-slate-600 pl-7">提交这个新文件。然后，您可以前往仓库的 "Actions" 标签页查看工作流的运行状态。成功后，Cloudflare Pages 会自动部署新网站，您就可以看到带搜索功能的索引页了！</p>
                    </div>
                 </div>
            </main>
        </div>

        <footer class="text-center mt-12 py-6 border-t border-slate-200">
            <p class="text-sm text-slate-500">由交互式应用生成器提供支持</p>
        </footer>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const branchNameInput = document.getElementById('branchName');
            const codeBlock = document.getElementById('code-block');
            const copyButton = document.getElementById('copy-button');

            function generateCode(branch = 'main') {
              return `name: Generate Index Page

on:
  push:
    branches:
      - ${branch}

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Run script to generate index.html
        run: |
          import os
          import subprocess
          from datetime import datetime
          
          def get_file_commit_date(filepath):
              try:
                  cmd = ['git', 'log', '-1', '--format=%cI', filepath]
                  result = subprocess.check_output(cmd).decode('utf-8').strip()
                  return datetime.fromisoformat(result)
              except Exception as e:
                  print(f"Could not get commit date for {filepath}: {e}")
                  return datetime.min

          html_files = []
          for root, _, files in os.walk('.'):
              if '.git' in root or '.github' in root:
                  continue
              for file in files:
                  if file.endswith('.html') and file != 'index.html':
                      filepath = os.path.join(root, file)
                      html_files.append({
                          'path': filepath.lstrip('./'),
                          'date': get_file_commit_date(filepath)
                      })

          html_files.sort(key=lambda x: x['date'], reverse=True)

          # Build the HTML content as a list of strings to avoid YAML parsing issues
          html_parts = [
              '<!DOCTYPE html>',
              '<html lang="zh-CN">',
              '<head>',
              '    <meta charset="UTF-8">',
              '    <meta name="viewport" content="width=device-width, initial-scale=1.0">',
              '    <title>网站目录</title>',
              '    <script src="https://cdn.tailwindcss.com"><\\/script>',
              '    <style>',
              "        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }",
              '    </style>',
              '</head>',
              '<body class="bg-slate-50 text-slate-800">',
              '    <div class="container mx-auto max-w-3xl p-4 md:p-8">',
              '        <header class="text-center mb-10">',
              '            <h1 class="text-3xl md:text-4xl font-bold text-slate-900">网站内容索引</h1>',
              '            <p class="mt-2 text-slate-600">所有页面均按最后更新时间倒序排列。</p>',
              '        </header>',
              '        <div class="mb-8">',
              '            <input type="text" id="searchInput" placeholder="在此输入关键词进行搜索..." class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition">',
              '        </div>',
              '        <main>',
              '            <div id="fileList" class="space-y-4">',
          ]

          if not html_files:
              html_parts.append('<p class="text-center text-slate-500">暂无内容。</p>')
          else:
              html_parts.append('<ul class="space-y-3">')
              for item in html_files:
                  date_str = item['date'].strftime('%Y-%m-%d')
                  list_item = f"""                <li class="file-item bg-white p-4 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300">
                    <a href="{item['path']}" class="flex justify-between items-center">
                        <span class="file-name text-lg font-medium text-sky-700 hover:text-sky-600">{item['path']}</span>
                        <span class="text-sm text-slate-500">{date_str}</span>
                    </a>
                </li>"""
                  html_parts.append(list_item)
              html_parts.append('</ul>')
          
          html_parts.extend([
              '            </div>',
              '        </main>',
              '        <footer class="text-center mt-12 py-4 border-t">',
              '            <p class="text-sm text-slate-500">索引由 GitHub Actions 自动生成</p>',
              '        </footer>',
              '    </div>',
              '    <script>',
              "        const searchInput = document.getElementById('searchInput');",
              "        const fileList = document.getElementById('fileList');",
              "        const items = fileList.getElementsByClassName('file-item');",
              "        searchInput.addEventListener('input', function(e) {",
              "            const searchTerm = e.target.value.toLowerCase();",
              "            for (let i = 0; i < items.length; i++) {",
              "                const item = items[i];",
              "                const fileName = item.querySelector('.file-name').textContent.toLowerCase();",
              "                if (fileName.includes(searchTerm)) {",
              "                    item.style.display = '';",
              "                } else {",
              "                    item.style.display = 'none';",
              "                }",
              "            }",
              "        });",
              '    <\\/script>',
              '</body>',
              '</html>',
          ])
          
          html_content = "\\n".join(html_parts)
          
          with open('index.html', 'w', encoding='utf-8') as f:
              f.write(html_content)
          print("index.html generated successfully.")

      - name: Commit and push if changed
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          git add index.html
          if git diff --staged --quiet; then
            echo "No changes to commit."
            exit 0
          fi
          git commit -m "Automated: Update index.html with search functionality"
          git push
`;
            }

            function updateCode() {
                const branch = branchNameInput.value || 'main';
                codeBlock.textContent = generateCode(branch);
            }

            branchNameInput.addEventListener('input', updateCode);

            copyButton.addEventListener('click', () => {
                const textToCopy = codeBlock.textContent;
                const tempTextArea = document.createElement('textarea');
                tempTextArea.value = textToCopy;
                document.body.appendChild(tempTextArea);
                tempTextArea.select();
                try {
                    document.execCommand('copy');
                    copyButton.textContent = '已复制!';
                    setTimeout(() => {
                        copyButton.textContent = '复制';
                    }, 2000);
                } catch (err) {
                    console.error('无法复制文本: ', err);
                    copyButton.textContent = '失败';
                }
                document.body.removeChild(tempTextArea);
            });

            updateCode();
        });
    </script>
</body>
</html>

